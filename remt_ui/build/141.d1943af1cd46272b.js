"use strict";(self.webpackChunkremt_ui=self.webpackChunkremt_ui||[]).push([[141],{8845:(k,q,o)=>{o.d(q,{I:()=>p});var t=o(4650);let p=(()=>{var n;class e{transform(_){new Date(_.from);const h=new Date(_.to).getTime()-Date.now(),b=Math.ceil(h/864e5);return b>0?b:"Done"}}return(n=e).\u0275fac=function(_){return new(_||n)},n.\u0275pipe=t.Yjl({name:"daysRemain",type:n,pure:!0}),e})()},7842:(k,q,o)=>{o.d(q,{z:()=>p});var t=o(4650);let p=(()=>{var n;class e{transform(_){const[C,O]=_.split("/"),h=new Date(C).getTime(),b=new Date(O).getTime();if(b<Date.now())return"Done";const T=(b-h)/864e5;if(T%30==0)return Math.floor(T/30).toString();const A=T%30;return Math.floor(T/30).toString()+" and "+A+(A>1?" days":" day")}}return(n=e).\u0275fac=function(_){return new(_||n)},n.\u0275pipe=t.Yjl({name:"monthsDiff",type:n,pure:!0}),e})()},9997:(k,q,o)=>{o.d(q,{_:()=>p});var t=o(4650);let p=(()=>{var n;class e{transform(_){if("number"==typeof _||null==_)return _;const C=(new Date).getTime()-new Date(_).getTime();return Math.round(C/31536e6)}}return(n=e).\u0275fac=function(_){return new(_||n)},n.\u0275pipe=t.Yjl({name:"userAge",type:n,pure:!0}),e})()},5266:(k,q,o)=>{o.d(q,{d:()=>b});var t=o(4650),p=o(1213),n=o(5496),e=o(6895),F=o(2673),_=o(5004),C=o(9997),O=o(7842);function h(Z,T){if(1&Z&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.ALo(3,"date"),t.qZA(),t.TgZ(4,"td"),t._uU(5),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.ALo(10,"monthsDiff"),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.ALo(13,"number"),t.qZA(),t.TgZ(14,"td"),t._uU(15),t.ALo(16,"number"),t.qZA()()),2&Z){const A=T.$implicit;t.xp6(2),t.Oqu(t.lcZ(3,6,A.createdAt)),t.xp6(3),t.Oqu(A.rooms),t.xp6(2),t.Oqu(A.rent),t.xp6(2),t.Oqu(t.lcZ(10,8,A.start+"/"+A.end)),t.xp6(3),t.Oqu(t.lcZ(13,10,A.rentTotal)),t.xp6(3),t.Oqu(t.lcZ(16,12,A.netTotal))}}let b=(()=>{var Z;class T{constructor(P,l){this.userEntityService=P,this.storageService=l,this.invoices=[],this.subscription=this.userEntityService.entities$.pipe().subscribe({next:x=>{this.user=x.find(E=>E._id===this.storageService.getId()),this.invoices="landlord"==this.user?.userTypeName?this.user?.invoices:this.user?.invoices?.filter(E=>E.tenantId===this.user?._id),this.invoices=this.invoices?.reduce((E,J)=>E.includes(E[E.findIndex(W=>W.invoiceId==J.invoiceId)])?E:[...E,J],[])}})}ngOnDestroy(){console.log("ngOnDestroy"),this.subscription.unsubscribe()}}return(Z=T).\u0275fac=function(P){return new(P||Z)(t.Y36(p.W),t.Y36(n.V))},Z.\u0275cmp=t.Xpm({type:Z,selectors:[["app-profile"]],decls:89,vars:22,consts:[[1,"container-fluid","m-0","h-100","w-100"],[1,"row","m-2"],[1,"card","col-sm-6","flex-row",2,"background-color","rgb(112, 111, 111)"],["src","../../../assets//imgs//img7.jpg","width","75px","height","75px","alt",""],[1,"card","col-sm-6"],[1,"card","col-12"],[1,"mx-2"],[1,"card","m-0","p-0"],[1,"card-header","d-flex","justify-content-between"],["matBadgeOverlap","false","matBadgeColor","accent","matBadgeSize","small",3,"matBadge"],[1,"card-body"],[1,"table-responsive"],[1,"table","table-bordered","border-dark"],["scope","col"],[1,"table-group-divider"],[4,"ngFor","ngForOf"],["type","button",1,"mx-2"],[1,"card-body","row"],[1,"col-sm-6"]],template:function(P,l){1&P&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div"),t._UZ(4,"img",3),t.qZA(),t._uU(5,"\xa0\xa0\xa0 "),t.TgZ(6,"div")(7,"h5")(8,"b"),t._uU(9,"Name: "),t.qZA(),t._uU(10),t.ALo(11,"formatNames"),t.qZA(),t.TgZ(12,"p")(13,"b"),t._uU(14,"Tel: "),t.qZA(),t._uU(15),t.qZA()()(),t.TgZ(16,"div",4)(17,"p")(18,"b"),t._uU(19,"Member Since: "),t.qZA(),t._uU(20),t.ALo(21,"date"),t.qZA(),t.TgZ(22,"p")(23,"b"),t._uU(24,"User Type: "),t.qZA(),t._uU(25),t.qZA()(),t.TgZ(26,"div",5)(27,"h6",6),t._uU(28),t.ALo(29,"formatNames"),t.qZA(),t.TgZ(30,"p"),t._uU(31),t.qZA()()(),t.TgZ(32,"div",1)(33,"div",7)(34,"div",8)(35,"h6",9),t._uU(36),t.qZA()(),t.TgZ(37,"div",10)(38,"div",11)(39,"table",12)(40,"thead")(41,"tr")(42,"th",13),t._uU(43,"Issued"),t.qZA(),t.TgZ(44,"th",13),t._uU(45,"Rooms"),t.qZA(),t.TgZ(46,"th",13),t._uU(47,"Rent"),t.qZA(),t.TgZ(48,"th",13),t._uU(49,"Duration "),t.TgZ(50,"small"),t._uU(51,"(months)"),t.qZA()(),t.TgZ(52,"th",13),t._uU(53,"Total"),t.qZA(),t.TgZ(54,"th",13),t._uU(55,"Net Total "),t.TgZ(56,"small"),t._uU(57,"[+ 7% tax]"),t.qZA()()()(),t.TgZ(58,"tbody",14),t.YNc(59,h,17,14,"tr",15),t.qZA()()()()()(),t.TgZ(60,"div",1)(61,"div",7)(62,"div",8)(63,"h6",6),t._uU(64,"Personal Information"),t.qZA(),t.TgZ(65,"button",16),t._uU(66,"edit"),t.qZA()(),t.TgZ(67,"div",17)(68,"p",18)(69,"b"),t._uU(70,"Name:"),t.qZA(),t._uU(71),t.qZA(),t.TgZ(72,"p",18)(73,"b"),t._uU(74,"Gender"),t.qZA(),t._uU(75),t.qZA(),t.TgZ(76,"p",18)(77,"b"),t._uU(78,"PhoneNumber: "),t.qZA(),t._uU(79),t.qZA(),t.TgZ(80,"p",18)(81,"b"),t._uU(82,"Age:"),t.qZA(),t._uU(83),t.ALo(84,"userAge"),t.qZA(),t.TgZ(85,"p",18)(86,"b"),t._uU(87,"Nation Id"),t.qZA(),t._uU(88),t.qZA()()()()()),2&P&&(t.xp6(10),t.Oqu(t.lcZ(11,14,null==l.user?null:l.user.userInfos.name)),t.xp6(5),t.Oqu(null==l.user?null:l.user.userInfos.phoneNumber),t.xp6(5),t.Oqu(t.lcZ(21,16,null==l.user?null:l.user.createdAt)),t.xp6(5),t.Oqu(null==l.user?null:l.user.userTypeName),t.xp6(3),t.hij("",t.lcZ(29,18,null==l.user?null:l.user.userTypeName)," Summary"),t.xp6(3),t.hij(" ",null==l.user||null==l.user.userInfos?null:l.user.userInfos.summary," "),t.xp6(4),t.Q6J("matBadge",null==l.invoices?null:l.invoices.length),t.xp6(1),t.hij("Invoices ","landlord"==(null==l.user?null:l.user.userTypeName)?"Created":"Received",""),t.xp6(23),t.Q6J("ngForOf",l.invoices),t.xp6(12),t.hij(" ",null==l.user||null==l.user.userInfos?null:l.user.userInfos.name,""),t.xp6(4),t.hij(" ",null==l.user||null==l.user.userInfos?null:l.user.userInfos.gender,""),t.xp6(4),t.hij(" ",null==l.user||null==l.user.userInfos?null:l.user.userInfos.phoneNumber,""),t.xp6(4),t.hij(" ",t.lcZ(84,20,null==l.user||null==l.user.userInfos?null:l.user.userInfos.age),""),t.xp6(5),t.hij(" ",null==l.user||null==l.user.userInfos?null:l.user.userInfos.nation_Id,""))},dependencies:[e.sg,F.k,e.JJ,e.uU,_.Q,C._,O.z],styles:["img[_ngcontent-%COMP%]{border-radius:50%}"]}),T})()},6467:(k,q,o)=>{o.d(q,{k:()=>F});var t=o(1656),p=o(4650),n=o(529),e=o(5496);let F=(()=>{var _;class C extends t.c8{constructor(h,b,Z){super("House",h),this.http=b,this.storage=Z}}return(_=C).\u0275fac=function(h){return new(h||_)(p.LFG(t.yV),p.LFG(n.eN),p.LFG(e.V))},_.\u0275prov=p.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),C})()},4407:(k,q,o)=>{o.d(q,{I:()=>S});var t=o(4006),p=o(5412),n=o(9841),e=o(4650),F=o(8252),_=o(9201),C=o(1213),O=o(5496),h=o(6895),b=o(3546),Z=o(4859),T=o(9549),A=o(4385),P=o(3238),l=o(4144),x=o(9602);function E(s,f){if(1&s){const m=e.EpF();e.TgZ(0,"mat-option",33),e.NdJ("click",function(){const r=e.CHM(m),u=r.index,a=r.$implicit,I=e.oxw();return e.KtG(I.userChange(u,a))}),e._uU(1),e.qZA()}if(2&s){const m=f.$implicit;e.Q6J("value",m.client.userInfos.name),e.xp6(1),e.hij(" ",m.client.userInfos.name," ")}}function J(s,f){1&s&&(e.TgZ(0,"mat-hint"),e._uU(1,"Read Only Field"),e.qZA())}function W(s,f){1&s&&(e.TgZ(0,"mat-error",34),e._uU(1," Duration is required "),e.qZA())}function K(s,f){1&s&&(e.TgZ(0,"mat-hint"),e._uU(1,"Read Only Field"),e.qZA())}function Q(s,f){1&s&&(e.TgZ(0,"mat-hint"),e._uU(1,"Read Only Field"),e.qZA())}function g(s,f){1&s&&(e.TgZ(0,"mat-hint"),e._uU(1,"Read Only Field"),e.qZA())}function D(s,f){1&s&&(e.TgZ(0,"mat-hint"),e._uU(1,"Read Only Field"),e.qZA())}function N(s,f){1&s&&(e.TgZ(0,"mat-hint"),e._uU(1,"Read Only Field"),e.qZA())}let v=(()=>{var s;class f{constructor(i,r,u,a,I,c,y){this.router=i,this.formBuilder=r,this.dialog=u,this.msg=a,this.userEntityService=I,this.dialogData=c,this.storageService=y,this.estates=[],this.tenants=[],this.readOnly=!1,this.invoiceForm=this.formBuilder.group({_id:[y.getId()],invoiceId:["",t.kI.required],invoiceName:["",t.kI.required],tenantId:["",t.kI.required],tenantName:["",t.kI.required],tenantPhoneNumber:["",t.kI.required],tax:[7],netTotal:[0,t.kI.required],houseId:["",t.kI.required],houseType:["",t.kI.required],start:["",t.kI.required],end:["",t.kI.required],rooms:[0,t.kI.required],rent:[0,t.kI.required],createdAt:[new Date],rentTotal:[0,t.kI.required],action:[c.action]}),(0,n.a)([this.invoiceForm.get("rooms")?.valueChanges,this.invoiceForm.get("rent")?.valueChanges,this.invoiceForm.get("start")?.valueChanges,this.invoiceForm.get("end")?.valueChanges]).subscribe({next:([M,B,H,w])=>{console.log(M,B),this.invoiceForm?.get("rentTotal")?.setValue(M*this.getMonthDiff(H,w,B));const V=this.invoiceForm?.get("tax")?.value/100*this.invoiceForm?.get("rentTotal")?.value+this.invoiceForm?.get("rentTotal")?.value;this.invoiceForm?.get("netTotal")?.setValue(V)}})}ngOnDestroy(){clearTimeout(this.timeOutId)}readonlyHint(){return this.readOnly=!0,this.timeOutId=setTimeout(()=>this.readOnly=!1,4e3)}getMonthDiff(i,r,u){const a=new Date(i),y=u/30,M=(new Date(r).getTime()-a.getTime())/864e5;return console.log("days ",M),M*y}ngOnInit(){this.userEntityService.entities$.pipe().subscribe({next:i=>{const r=i.find(a=>a._id===this.storageService.getId());console.log(r),this.estates=i.filter(a=>"landlord"===a.userTypeName).map(a=>a.estates).reduce((a,I)=>a.concat(I),[]),"caretaker"==r?.userTypeName?this.estates=this.estates.filter(a=>a.caretakers?.find(I=>I===this.storageService.getId())):"landlord"==r?.userTypeName&&(this.estates=this.estates.filter(a=>a.owner_Id===this.storageService.getId())),console.log("caretakers mng estates ",this.estates);let u=this.estates?.filter(a=>a.rental_history.length>0).map(a=>a.rental_history?.map(c=>({...c,rent:c.rent,rooms:c.rooms,house:a})));u=u?.reduce((a,I)=>a?.concat(I),[]),this.tenants=u?.map(a=>{const I=i.find(y=>y._id==a.client),c={...a};return c.client=I,c})}})}saveInvoice(){this.invoiceForm.valid?(console.log(this.invoiceForm.value),this.userEntityService.update(this.invoiceForm.value).subscribe({next:i=>{this.msg.message({title:"Form Submit Success",text:"successfully submited",color:"green"}),this.userEntityService.getAll(),this.dialog.closeAll(),console.log(i)},error:i=>{console.log(i),this.msg.message({text:i.message,title:"Property Register Failure",color:"red"})}})):this.msg.message({title:"Invalid Form",text:"Please fill the required fields before submit",color:"red"})}userChange(i,r){this.invoiceForm.get("tenantName")?.setValue(r.client.userInfos.name),this.invoiceForm.get("tenantId")?.setValue(r.client._id),this.invoiceForm?.get("houseId")?.setValue(r.house._id);const u=this.invoiceForm.get("tenantName")?.value.split(" ")[0]+"_"+Date.now();this.invoiceForm.get("invoiceId")?.setValue(u),this.invoiceForm.get("tenantPhoneNumber")?.setValue(r.client.userInfos.phoneNumber),this.invoiceForm?.get("houseType")?.setValue(r.house.type),this.invoiceForm?.get("rent")?.setValue(r.rent),this.invoiceForm?.get("start")?.setValue(r.from),this.invoiceForm?.get("end")?.setValue(r.to),this.invoiceForm?.get("rooms")?.setValue(r.rooms),this.invoiceForm?.get("rentTotal")?.setValue(this.invoiceForm?.get("rooms")?.value*this.invoiceForm?.get("rent")?.value);const a=this.invoiceForm?.get("tax")?.value/100*this.invoiceForm?.get("rentTotal")?.value+this.invoiceForm?.get("rentTotal")?.value;this.invoiceForm?.get("netTotal")?.setValue(a)}}return(s=f).\u0275fac=function(i){return new(i||s)(e.Y36(F.F0),e.Y36(t.qu),e.Y36(p.uw),e.Y36(_.e),e.Y36(C.W),e.Y36(p.WI),e.Y36(O.V))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-invoices"]],decls:114,vars:11,consts:[["mat-dialog-title","","align","center"],[3,"formGroup"],[1,"row","border"],["align","center"],[1,"col-md-12"],[1,"w-100"],["name","invoiceName","matInput","","type","text","placeholder","invoice Name","formControlName","invoiceName"],[1,"row"],[1,"col-md-6"],["matInput","","formControlName","tenantName"],[3,"value","click",4,"ngFor","ngForOf"],["readonly","","matInput","","type","text","placeholder","tenantId","formControlName","tenantId",3,"click"],[4,"ngIf"],["name","tenantPhoneNumber","matInput","","type","text","placeholder","tenantPhoneNumber","formControlName","tenantPhoneNumber"],[3,"rangePicker"],["placeholder","Start date","matStartDate","","formControlName","start"],["placeholder","End date","matEndDate","","formControlName","end"],["matIconSuffix","",3,"for"],["duration",""],["class","text-danger",4,"ngIf"],["readonly","","matInput","","type","text","placeholder","houseType","formControlName","houseType",3,"click"],["matInput","","type","text","readonly","","placeholder","houseId","formControlName","houseId",3,"click"],["matInput","","type","text","placeholder","rooms","formControlName","rooms"],["matInput","","type","text","placeholder","rent","formControlName","rent"],[1,"col-md-4"],["matInput","","type","text","readonly","","placeholder","total","formControlName","rentTotal",3,"click"],["name","tax","readonly","","matInput","","placeholder","tax","formControlName","tax",3,"click"],["name","netTotal","readonly","","matInput","","placeholder","netTotal","formControlName","netTotal",3,"click"],["align","end"],["mat-button","","mat-dialog-close","",1,"bg-warning","text-black"],[1,"fa","fa-window-close"],["mat-button","",1,"bg-warning","text-black",3,"click"],[1,"fa","fa-save"],[3,"value","click"],[1,"text-danger"]],template:function(i,r){if(1&i&&(e.TgZ(0,"mat-dialog-content")(1,"h3",0)(2,"b"),e._uU(3,"Create Invoice"),e.qZA()(),e.TgZ(4,"mat-card")(5,"mat-card-content")(6,"form",1)(7,"div",2)(8,"h6",3)(9,"small")(10,"b"),e._uU(11,"Invoice Details"),e.qZA()()(),e.TgZ(12,"div",4)(13,"mat-form-field",5)(14,"mat-label"),e._uU(15,"Invoice Name"),e.qZA(),e._UZ(16,"input",6),e.qZA()()(),e._UZ(17,"br"),e.TgZ(18,"div",7)(19,"h6",3)(20,"small")(21,"b"),e._uU(22,"Tenant Details"),e.qZA()()(),e.TgZ(23,"div",8)(24,"mat-form-field",5)(25,"mat-label"),e._uU(26,"Tenant Name"),e.qZA(),e.TgZ(27,"mat-select",9),e.YNc(28,E,2,2,"mat-option",10),e.qZA(),e.TgZ(29,"mat-hint"),e._uU(30,"Select name to populate other fields "),e.qZA()()(),e.TgZ(31,"div",8)(32,"mat-form-field",5)(33,"mat-label"),e._uU(34,"Tenant Id"),e.qZA(),e.TgZ(35,"input",11),e.NdJ("click",function(){return r.readonlyHint()}),e.qZA(),e.YNc(36,J,2,0,"mat-hint",12),e.qZA()(),e.TgZ(37,"div",8)(38,"mat-form-field",5)(39,"mat-label"),e._uU(40,"Tenant phoneNumber"),e.qZA(),e._UZ(41,"input",13),e.qZA()(),e.TgZ(42,"div",8)(43,"mat-form-field",5)(44,"mat-label"),e._uU(45,"Date range"),e.qZA(),e.TgZ(46,"mat-date-range-input",14),e._UZ(47,"input",15)(48,"input",16),e.qZA(),e.TgZ(49,"mat-hint"),e._uU(50,"MM/DD/YYYY - MM/DD/YYYY"),e.qZA(),e._UZ(51,"mat-datepicker-toggle",17)(52,"mat-date-range-picker",null,18),e.YNc(54,W,2,0,"mat-error",19),e.qZA()()(),e._UZ(55,"br"),e.TgZ(56,"div",7)(57,"h6",3)(58,"small")(59,"b"),e._uU(60,"House Details"),e.qZA()()(),e.TgZ(61,"div",8)(62,"mat-form-field",5)(63,"mat-label"),e._uU(64,"House Type"),e.qZA(),e.TgZ(65,"input",20),e.NdJ("click",function(){return r.readonlyHint()}),e.qZA(),e.YNc(66,K,2,0,"mat-hint",12),e.qZA()(),e.TgZ(67,"div",8)(68,"mat-form-field",5)(69,"mat-label"),e._uU(70,"House Id"),e.qZA(),e.TgZ(71,"input",21),e.NdJ("click",function(){return r.readonlyHint()}),e.qZA(),e.YNc(72,Q,2,0,"mat-hint",12),e.qZA()(),e.TgZ(73,"div",8)(74,"mat-form-field",5)(75,"mat-label"),e._uU(76,"Rooms"),e.qZA(),e._UZ(77,"input",22),e.qZA()(),e.TgZ(78,"div",8)(79,"mat-form-field",5)(80,"mat-label"),e._uU(81,"Rent"),e.qZA(),e._UZ(82,"input",23),e.qZA()()(),e._UZ(83,"br"),e.TgZ(84,"div",7)(85,"h6",3)(86,"small")(87,"b"),e._uU(88,"Cost Summary"),e.qZA()()(),e.TgZ(89,"div",24)(90,"mat-form-field",5)(91,"mat-label"),e._uU(92,"Total"),e.qZA(),e.TgZ(93,"input",25),e.NdJ("click",function(){return r.readonlyHint()}),e.qZA(),e.YNc(94,g,2,0,"mat-hint",12),e.qZA()(),e.TgZ(95,"div",24)(96,"mat-form-field",5)(97,"mat-label"),e._uU(98,"Tax (%)"),e.qZA(),e.TgZ(99,"input",26),e.NdJ("click",function(){return r.readonlyHint()}),e.qZA(),e.YNc(100,D,2,0,"mat-hint",12),e.qZA()(),e.TgZ(101,"div",24)(102,"mat-form-field",5)(103,"mat-label"),e._uU(104,"NetTotal"),e.qZA(),e.TgZ(105,"input",27),e.NdJ("click",function(){return r.readonlyHint()}),e.qZA(),e.YNc(106,N,2,0,"mat-hint",12),e.qZA()()()()()()(),e.TgZ(107,"mat-dialog-actions",28)(108,"button",29),e._UZ(109,"i",30),e._uU(110," Cancel"),e.qZA(),e.TgZ(111,"button",31),e.NdJ("click",function(){return r.saveInvoice()}),e._UZ(112,"i",32),e._uU(113," Save"),e.qZA()()),2&i){const u=e.MAs(53);let a;e.xp6(6),e.Q6J("formGroup",r.invoiceForm),e.xp6(22),e.Q6J("ngForOf",r.tenants),e.xp6(8),e.Q6J("ngIf",r.readOnly),e.xp6(10),e.Q6J("rangePicker",u),e.xp6(5),e.Q6J("for",u),e.xp6(3),e.Q6J("ngIf",(null==(a=r.invoiceForm.get("duration"))?null:a.touched)&&(null==(a=r.invoiceForm.get("duration"))?null:a.invalid)),e.xp6(12),e.Q6J("ngIf",r.readOnly),e.xp6(6),e.Q6J("ngIf",r.readOnly),e.xp6(22),e.Q6J("ngIf",r.readOnly),e.xp6(6),e.Q6J("ngIf",r.readOnly),e.xp6(6),e.Q6J("ngIf",r.readOnly)}},dependencies:[h.sg,h.O5,t._Y,t.Fj,t.JJ,t.JL,t.sg,t.u,b.a8,b.dn,Z.lW,T.KE,T.hX,T.bx,T.TO,T.R9,A.gD,P.ey,l.Nt,x.nW,x.wx,x.zY,x.By,x._g,p.ZT,p.uh,p.xY,p.H8],styles:["mat-hint[_ngcontent-%COMP%]{color:red}mat-card-content[_ngcontent-%COMP%], form[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{text-decoration:underline;text-decoration-color:red}"]}),f})();var d=o(8255),Y=o(7392),L=o(7842);let R=(()=>{var s;class f{transform(i){return null==i?i:i.slice().sort((r,u)=>new Date(u.createdAt).getTime()-new Date(r.createdAt).getTime()).reduce((r,u)=>r.includes(r[r.findIndex(a=>a.invoiceId==u.invoiceId)])?r:[...r,u],[])}}return(s=f).\u0275fac=function(i){return new(i||s)},s.\u0275pipe=e.Yjl({name:"sortInvoices",type:s,pure:!0}),f})();function U(s,f){if(1&s){const m=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.ALo(9,"monthsDiff"),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.ALo(12,"number"),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.ALo(15,"number"),e.qZA(),e.TgZ(16,"td")(17,"div",9)(18,"mat-menu",null,10)(20,"a",11),e.NdJ("click",function(){const u=e.CHM(m).$implicit,a=e.oxw();return e.KtG(a.editInvoice(u))}),e._UZ(21,"i",12),e._uU(22," Edit "),e.qZA(),e.TgZ(23,"a",13),e.NdJ("click",function(){const u=e.CHM(m).$implicit,a=e.oxw();return e.KtG(a.deleteInvoice(u))}),e._UZ(24,"i",14),e._uU(25," Delete "),e.qZA()(),e.TgZ(26,"span",15)(27,"mat-icon"),e._uU(28,"more_vert"),e.qZA()()()()()}if(2&s){const m=f.$implicit,i=e.MAs(19);e.xp6(2),e.Oqu(m.tenantName),e.xp6(2),e.Oqu(m.rooms),e.xp6(2),e.Oqu(m.rent),e.xp6(2),e.Oqu(e.lcZ(9,7,m.start+"/"+m.end)),e.xp6(3),e.Oqu(e.lcZ(12,9,m.rentTotal)),e.xp6(3),e.Oqu(e.lcZ(15,11,m.netTotal)),e.xp6(12),e.Q6J("matMenuTriggerFor",i)}}let S=(()=>{var s;class f{constructor(i,r,u){this.userEntityService=i,this.storageService=r,this.dialog=u,this.estates=[],this.tenants=[],this.subscription=this.userEntityService.entities$.pipe().subscribe({next:a=>{this.caretaker=a.find(c=>c._id===r.getId()),this.estates=a.filter(c=>"landlord"===c.userTypeName).map(c=>c.estates).reduce((c,y)=>c.concat(y),[]),this.estates=this.estates.filter(c=>c.caretakers?.find(y=>y===this.storageService.getId()));let I=this.estates?.filter(c=>c.rental_history.length>0).map(c=>c.rental_history?.map(M=>({...M,house:c})));I=I?.reduce((c,y)=>c?.concat(y),[]),this.tenants=I?.map(c=>{const y=a.find(B=>B._id==c.client),M={...c};return M.client=y,M})}})}ngOnInit(){}ngOnDestroy(){console.log("ngOnDestroy from CreateInvoicesComponent"),this.subscription.unsubscribe()}invoiceFormDialog(){this.dialog.open(v,{data:{action:"create invoice"}})}editInvoice(i){console.log("edit invoice called ",i)}deleteInvoice(i){console.log("delete invoice called ",i)}}return(s=f).\u0275fac=function(i){return new(i||s)(e.Y36(C.W),e.Y36(O.V),e.Y36(p.uw))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-create-invoices"]],decls:32,vars:3,consts:[[1,"card"],[1,"card-header","d-flex","justify-content-between"],[1,"btn","btn-sm","bg-dark","text-warning",3,"click"],[1,"card-body"],[1,"table-responsive"],[1,"table"],["scope","col"],[1,"table-group-divider"],[4,"ngFor","ngForOf"],[1,""],["navOptions","matMenu"],["mat-menu-item","",1,"mt-1","bg-warning","text-black",3,"click"],[1,"fa","fa-edit"],["mat-menu-item","",1,"mt-1","bg-danger","text-black",3,"click"],[1,"fa","fa-trash"],["mat-icon-button","",3,"matMenuTriggerFor"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3"),e._uU(3,"Invoice Listings"),e.qZA(),e.TgZ(4,"a",2),e.NdJ("click",function(){return r.invoiceFormDialog()}),e._uU(5," New [+] "),e.qZA()(),e.TgZ(6,"div",3)(7,"div",4)(8,"table",5)(9,"thead")(10,"tr")(11,"th",6),e._uU(12,"Tenant"),e.qZA(),e.TgZ(13,"th",6),e._uU(14,"Rooms"),e.qZA(),e.TgZ(15,"th",6),e._uU(16,"Rent"),e.qZA(),e.TgZ(17,"th",6),e._uU(18,"Duration "),e.TgZ(19,"small"),e._uU(20,"(months)"),e.qZA()(),e.TgZ(21,"th",6),e._uU(22,"Total"),e.qZA(),e.TgZ(23,"th",6),e._uU(24,"Net Total "),e.TgZ(25,"small"),e._uU(26,"[+ 7% tax]"),e.qZA()(),e.TgZ(27,"th"),e._uU(28,"Actions"),e.qZA()()(),e.TgZ(29,"tbody",7),e.YNc(30,U,29,13,"tr",8),e.ALo(31,"sortInvoices"),e.qZA()()()()()),2&i&&(e.xp6(30),e.Q6J("ngForOf",e.lcZ(31,1,null==r.caretaker?null:r.caretaker.invoices)))},dependencies:[h.sg,d.VK,d.OP,d.p6,Y.Hw,h.JJ,L.z,R]}),f})()},323:(k,q,o)=>{o.d(q,{W:()=>Q});var t=o(4006),p=o(5412),n=o(4650),e=o(6467),F=o(1213),_=o(9201),C=o(6895),O=o(3546),h=o(9549),b=o(4144),Z=o(9602);function T(g,D){1&g&&(n.TgZ(0,"mat-error",20),n._uU(1," From is required "),n.qZA())}function A(g,D){1&g&&(n.TgZ(0,"mat-error",20),n._uU(1," To is required "),n.qZA())}function P(g,D){1&g&&(n.TgZ(0,"mat-error",20),n._uU(1," Rooms is required "),n.qZA())}function l(g,D){1&g&&(n.TgZ(0,"mat-hint"),n._uU(1," Rent must be above 10000 "),n.qZA())}function x(g,D){1&g&&(n.TgZ(0,"mat-error",20),n._uU(1," Rent is required "),n.qZA())}function E(g,D){1&g&&(n.TgZ(0,"mat-hint"),n._uU(1,"0754 767 767"),n.qZA())}function J(g,D){1&g&&(n.TgZ(0,"mat-error",20),n._uU(1," phoneNumber is required "),n.qZA())}function W(g,D){if(1&g){const N=n.EpF();n.TgZ(0,"button",21),n.NdJ("click",function(){n.CHM(N);const d=n.oxw();return n.KtG(d.approveTenant())}),n._UZ(1,"i",22),n._uU(2," Approve! "),n.qZA()}if(2&g){const N=n.oxw();n.Q6J("disabled",N.rentForm.invalid)}}function K(g,D){if(1&g){const N=n.EpF();n.TgZ(0,"button",21),n.NdJ("click",function(){n.CHM(N);const d=n.oxw();return n.KtG(d.editTenant())}),n._UZ(1,"i",22),n._uU(2),n.qZA()}if(2&g){const N=n.oxw();n.Q6J("disabled",N.rentForm.invalid),n.xp6(2),n.hij(" ",N.action||"Edit!"," ")}}let Q=(()=>{var g;class D{constructor(v,d,Y,L,R,U){this.houseEntityService=v,this.userEntityService=d,this.fb=Y,this.dialog=L,this.msgService=R,this.dialogData=U,this.estate={...U.estate},this.action=U.action,this.rentForm=this.fb.group({from:[new Date,t.kI.required],to:[new Date,t.kI.required],rent:["",[t.kI.required,t.kI.min(1e4)]],phoneNumber:["",t.kI.required],rooms:["",t.kI.required],house:[""],client:[""],action:[U.action],_id:[this.estate._id]}),U.estate&&U.history&&(this.rentForm.patchValue(U.history),this.rentForm.get("_id")?.setValue(U.estate._id),this.rentForm.get("house")?.setValue(U.estate)),console.log("rental-form patched from dialog-data ",this.rentForm.value)}approveTenant(){return console.log(this.rentForm.value),this.rentForm.valid?this.houseEntityService.update(this.rentForm.value).subscribe({next:v=>{console.log(v),this.userEntityService.getAll(),this.dialog.closeAll()},error:v=>{console.log(v),this.msgService.message({text:v.message,title:"Tenant Register Failure",color:"red"},7e3)}}):this.msgService.message({text:"Please fill the required form fields before submit",title:"Tenant Register Failure",color:"red"},7e3)}editTenant(){return console.log(this.rentForm.value),this.rentForm.valid?this.houseEntityService.update(this.rentForm.value).subscribe({next:v=>{console.log(v),this.userEntityService.getAll(),this.dialog.closeAll()},error:v=>{console.log(v),this.msgService.message({text:v.message,title:"Tenant Register Failure",color:"red"},7e3)}}):this.msgService.message({text:"Please fill the required form fields before submit",title:"Tenant Register Failure",color:"red"},7e3)}}return(g=D).\u0275fac=function(v){return new(v||g)(n.Y36(e.k),n.Y36(F.W),n.Y36(t.qu),n.Y36(p.uw),n.Y36(_.e),n.Y36(p.WI))},g.\u0275cmp=n.Xpm({type:g,selectors:[["app-rental-form"]],decls:52,vars:14,consts:[[1,"col-12"],[1,"d-flex","justify-content-center"],["mat-dialog-title",""],[3,"formGroup"],[1,"row"],[1,"col-md-6"],[1,"w-100"],["placeholder","from","matInput","","formControlName","from",3,"matDatepicker"],["matIconSuffix","",3,"for"],["from",""],["class","text-danger",4,"ngIf"],["placeholder","to","matInput","","formControlName","to",3,"matDatepicker"],["to",""],["name","rooms","placeholder","rooms","type","number","matInput","","formControlName","rooms"],["name","rent","placeholder","rent","type","text","matInput","","formControlName","rent"],[4,"ngIf"],["name","phoneNumber","matInput","","type","text","placeholder","phoneNumber","formControlName","phoneNumber"],["mat-dialog-close","",1,"btn","btn-sm"],[1,"fa","fa-window-close"],["class","btn btn-sm m-1",3,"disabled","click",4,"ngIf"],[1,"text-danger"],[1,"btn","btn-sm","m-1",3,"disabled","click"],[1,"fa","fa-plus-circle"]],template:function(v,d){if(1&v&&(n.TgZ(0,"mat-dialog-content",0)(1,"mat-card")(2,"mat-card-header",1)(3,"h3",2),n._uU(4," House Rent Record "),n.qZA()(),n.TgZ(5,"mat-card-content",1)(6,"form",3)(7,"div",4)(8,"div",5)(9,"mat-form-field",6)(10,"mat-label"),n._uU(11,"From"),n.qZA(),n._UZ(12,"input",7)(13,"mat-datepicker-toggle",8)(14,"mat-datepicker",null,9),n.YNc(16,T,2,0,"mat-error",10),n.qZA()(),n.TgZ(17,"div",5)(18,"mat-form-field",6)(19,"mat-label"),n._uU(20,"To"),n.qZA(),n._UZ(21,"input",11)(22,"mat-datepicker-toggle",8)(23,"mat-datepicker",null,12),n.YNc(25,A,2,0,"mat-error",10),n.qZA()(),n.TgZ(26,"div",5)(27,"mat-form-field",6)(28,"mat-label"),n._uU(29,"Rooms"),n.qZA(),n._UZ(30,"input",13),n.YNc(31,P,2,0,"mat-error",10),n.qZA()(),n.TgZ(32,"div",5)(33,"mat-form-field",6)(34,"mat-label"),n._uU(35,"Rent"),n.qZA(),n._UZ(36,"input",14),n.YNc(37,l,2,0,"mat-hint",15),n.YNc(38,x,2,0,"mat-error",10),n.qZA()(),n.TgZ(39,"div",5)(40,"mat-form-field",6)(41,"mat-label"),n._uU(42,"phoneNumber"),n.qZA(),n._UZ(43,"input",16),n.YNc(44,E,2,0,"mat-hint",15),n.YNc(45,J,2,0,"mat-error",10),n.qZA()()()()()()(),n.TgZ(46,"mat-dialog-actions",1)(47,"button",17),n._UZ(48,"i",18),n._uU(49,"Close "),n.qZA(),n.YNc(50,W,3,1,"button",19),n.YNc(51,K,3,2,"button",19),n.qZA()),2&v){const Y=n.MAs(15),L=n.MAs(24);let R,U,S,s,f,m,i;n.xp6(6),n.Q6J("formGroup",d.rentForm),n.xp6(6),n.Q6J("matDatepicker",Y),n.xp6(1),n.Q6J("for",Y),n.xp6(3),n.Q6J("ngIf",(null==(R=d.rentForm.get("from"))?null:R.touched)&&(null==(R=d.rentForm.get("from"))?null:R.invalid)),n.xp6(5),n.Q6J("matDatepicker",L),n.xp6(1),n.Q6J("for",L),n.xp6(3),n.Q6J("ngIf",(null==(U=d.rentForm.get("to"))?null:U.touched)&&(null==(U=d.rentForm.get("to"))?null:U.invalid)),n.xp6(6),n.Q6J("ngIf",(null==(S=d.rentForm.get("rooms"))?null:S.touched)&&(null==(S=d.rentForm.get("rooms"))?null:S.pristine)),n.xp6(6),n.Q6J("ngIf",(null==(s=d.rentForm.get("rent"))?null:s.touched)&&(null==(s=d.rentForm.get("rent"))?null:s.invalid)),n.xp6(1),n.Q6J("ngIf",(null==(f=d.rentForm.get("rent"))?null:f.touched)&&(null==(f=d.rentForm.get("rent"))?null:f.pristine)),n.xp6(6),n.Q6J("ngIf",(null==(m=d.rentForm.get("phoneNumber"))?null:m.touched)&&(null==(m=d.rentForm.get("phoneNumber"))?null:m.invalid)||(null==(m=d.rentForm.get("phoneNumber"))?null:m.dirty)&&(null==(m=d.rentForm.get("phoneNumber"))?null:m.invalid)),n.xp6(1),n.Q6J("ngIf",(null==(i=d.rentForm.get("phoneNumber"))?null:i.touched)&&(null==(i=d.rentForm.get("phoneNumber"))?null:i.invalid)),n.xp6(5),n.Q6J("ngIf",!d.dialogData.history),n.xp6(1),n.Q6J("ngIf",d.dialogData.history)}},dependencies:[C.O5,t._Y,t.Fj,t.wV,t.JJ,t.JL,t.sg,t.u,O.a8,O.dn,O.dk,h.KE,h.hX,h.bx,h.TO,h.R9,b.Nt,Z.Mq,Z.hl,Z.nW,p.ZT,p.uh,p.xY,p.H8],styles:["mat-dialog-content[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{background-color:#faad47!important;color:#000!important}"]}),D})()}}]);